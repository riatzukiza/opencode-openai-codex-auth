# Commit & PR Plan (2025-11-21)

## Summary

- Prepare commit and PR for current dev branch changes: logging controls, session cache key handling, prompt filtering, and removal of legacy compaction artifacts plus related docs updates.

## Code Files & Line References

- lib/config.ts:12-18,52-59 – Default config now includes logging toggles (warning toasts, console mirroring) merged with user config.
- lib/logger.ts:12-34,84-113,175-218,231-289 – Environment-driven logging defaults, overrides via plugin config, toast/console behaviors, and wrap logic to avoid truncation.
- lib/request/input-filters.ts:18-48,72-189 – Input sanitization, OpenCode system prompt filtering, bridge prompt injection with caching/continuity.
- lib/session/session-manager.ts:18-203,232-480 – Session cache key derivation (conversation/fork), prefix mismatch handling with reset or fork, prompt cache key reuse, and metrics.
- lib/types.ts:6-41,91-110 – Plugin/logging config shape and request/session typings.
- test/logger.test.ts:67-223 – Coverage for env vs config logging, warning toasts/console mirroring, rotation/queue overflow, and test-only console behavior.
- test/request-transformer.test.ts:121-1200 – Extensive cases for model normalization, prompt cache keys, bridge vs tool remap, ID stripping, include fields, and fallback logging expectations.
- test/session-manager.test.ts:48-189 – Session reuse, prefix mismatch warnings (system change/history prune), cache key regeneration, forks, and metrics/eviction behaviors.
- Removed: lib/compaction/\*.ts, lib/prompts/codex-compaction.ts, lib/request/compaction-helpers.ts, spec/auto-compaction-summary.md, spec/remove-plugin-compaction.md, spec/issue-triage-2025-11-20.md, spec/open-issues-triage.md, spec/pr-2-conflict-analysis.md, spec/pr-20-review.md, spec/review-pr-20-plan.md.

## Existing Issues / PRs

- None identified from history; last main commit a455bd1 "chore: release v0.4.3". Proceed on current dev branch.

## Requirements

- User request: commit all current changes and open a new PR from dev branch.
- Preserve user-authored changes; do not revert.

## Definition of Done

- All listed changes staged and committed on dev branch.
- `npm test` succeeds (or any failures documented).
- New PR opened targeting main with summary of logging/session/prompt updates and compaction removal.
