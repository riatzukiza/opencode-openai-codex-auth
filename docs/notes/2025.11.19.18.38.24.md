In lib/request/request-transformer.ts around lines 952 to 968, the
TransformResult interface is currently unexported which prevents consumers from
using the return type of transformRequestBody; change the declaration to export
interface TransformResult so itâ€™s exported from the module, and update any local
references or imports elsewhere if needed to use the exported type (no other
logic changes).

In lib/request/request-transformer.ts around lines 621 to 633, the code
duplicates the bridge message object creation (the developer role message with
CODEX_OPENCODE_BRIDGE and input merging) which is repeated later at lines
~658-667; extract a small helper (e.g., buildBridgeMessage(input):
Array<Message> or getBridgeMessage(input): Message[]) that returns the array
with the bridge message followed by the existing input and replace both
duplicated branches with a call to that helper, keeping existing types and
imports and ensuring generateContentHash("add") checks still control whether to
return the helper result or the original input.

lib/cache/cache-metrics.ts lines 34-53 (also apply similar changes at 59-79,
103-105, 167-185): the metrics object and API are tightened to prevent
accidental writes to the aggregate bucket but getMetrics currently performs only
a shallow clone so callers can still mutate nested CacheMetrics; update the
types to use keyof Omit<CacheMetricsCollection, "overall"> for per-key
operations (hits/misses/evictions) and ensure every place that updates rates
also recomputes and updates the "overall" hitRate consistently, and either
return a deep-cloned/read-only snapshot from getMetrics or clearly document the
return as read-only to prevent external mutation.

In lib/cache/cache-warming.ts around lines 113 to 126, the catch block declares
an unused named parameter (\_error) causing lint/typecheck warnings; remove the
unused binding by changing the catch to a bare catch (i.e., catch { ... }) so
the error is still ignored and the function behavior remains identical while
satisfying the linter.
